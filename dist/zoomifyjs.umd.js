!function(t,e){"object"==typeof exports&&typeof module<"u"?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self).ZoomifyJs=e()}(this,(function(){"use strict";var t=Object.defineProperty,e=(e,o,s)=>(((e,o,s)=>{o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s})(e,"symbol"!=typeof o?o+"":o,s),s);const o=class t{constructor(t={}){this.resolveConfig(t),this.handleFocusZoom=t=>{t.preventDefault(),!this.animating&&(this.animating=!0,requestAnimationFrame((()=>{this.focusZoom.call(this,t),this.animating=!1})))},this.handleFocusZoomOut=t=>this.focusZoomOut.call(this,t),this.handleTouchEnd=t=>this.touchEnd.call(this,t),this.handleMouseEnter=t=>this.mouseEnter.call(this,t),this.handleMouseOut=t=>this.mouseOut.call(this,t),this.init(),this.timeout=null,this.lastTap=0}resolveConfig(e){const o=t.DEFAULT_SETTINGS,s=e;if("string"==typeof e)o.selector=e;else for(const e in s)"string"==typeof e&&t.ALLOWED_OPTIONS.includes(e)&&(o[e]=s[e]);return this.config=o,this.config}getElement(){return this.element||(this.element="string"==typeof this.config.selector?document.querySelector(this.config.selector):this.config.selector),this.element}init(){const t=this.getElement();if(t.style.cursor="zoom-in",this.config.clickToZoom){t.zoomifyJs=this;const e=document.createElement("button");return e.setAttribute("id","zoomifyJs-click-to-zoom"),e.style.border=0,e.style.background="rgba(0,0,0, 0.5)",e.style.padding="10px",e.style.paddingLeft="15px",e.style.paddingRight="15px",e.style.borderRadius="20px",e.style.position="absolute",e.style.bottom="15px",e.style.zIndex=10,e.style.left=0,e.style.right=0,e.style.width="max-content",e.style.color="white",e.style.margin="0 auto",e.style.pointerEvents="none",e.textContent=this.config.buttonText,t.parentElement.style.position="relative",t.parentElement.appendChild(e),void t.addEventListener("click",(t=>{const o=this.zoomedIn;this.zoomedIn=!this.zoomedIn,this.setZoomEvents(o),this.mouseEnter(t),e.style.display=o?"block":"none"}))}this.setZoomEvents()}zoomIn(){const t=this.getElement();t.style.transition=`scale ${this.config.transitionDuration}ms ${this.config.easing}`,this.focusZoom({target:t},!0)}zoomOut(){const t=this.getElement();this.focusZoomOut({target:t})}enableZoom(t){return this.zoom=t,t?this.zoomIn():this.zoomOut()}setZoomEvents(t=!1){const e=this.getElement();if(e.zoomifyJs=this,e.attributes.zoomify&&""!==e.attributes.zoomify.value){(new Image).src=e.attributes.zoomify.value}if(["touchstart"].forEach((o=>{t?e.removeEventListener(o,(()=>this.enableZoom(!this.zoom))):e.addEventListener(o,(()=>this.enableZoom(!0)),{passive:!0})})),["mouseenter"].forEach((o=>{t?e.removeEventListener(o,this.handleMouseEnter):e.addEventListener(o,this.handleMouseEnter,{passive:!0})})),["mouseout"].forEach((o=>{t?e.removeEventListener(o,this.handleMouseOut):e.addEventListener(o,this.handleMouseOut,{passive:!0})})),["mousemove","touchmove"].forEach((o=>{t?e.removeEventListener(o,this.handleFocusZoom):e.addEventListener(o,this.handleFocusZoom)})),["mouseleave"].forEach((o=>{t?e.removeEventListener(o,this.handleFocusZoomOut):e.addEventListener(o,this.handleFocusZoomOut,{passive:!0})})),["touchend"].forEach((o=>{t?e.removeEventListener(o,this.handleTouchEnd):e.addEventListener(o,this.handleTouchEnd)})),t)this.focusZoomOut({target:e}),e.removeEventListener("contextmenu",this.preventContextMenu),"IMG"===e.tagName&&"PICTURE"===e.parentElement.tagName&&setTimeout((()=>{e.parentElement.style.removeProperty("display"),e.parentElement.style.removeProperty("overflow"),e.parentElement.style.removeProperty("max-height"),e.parentElement.style.removeProperty("max-width"),e.style.removeProperty("transition"),e.removeAttribute("data-src")}),this.config.transitionDuration);else{if(e.addEventListener("contextmenu",this.preventContextMenu),e.style.transition=`scale ${this.config.transitionDuration}ms ${this.config.easing}`,"IMG"===e.tagName&&"PICTURE"===e.parentElement.tagName){const t=e.getBoundingClientRect();e.parentElement.style.display="block",e.parentElement.style.overflow="hidden",e.parentElement.style.maxHeight=`${t.height}px`,e.parentElement.style.maxWidth=`${t.width}px`}e.zoomifyJs=this}}preventContextMenu(t){t.preventDefault()}static inBoundaries(t,e,o){const s=t.left+window.scrollX,i=t.top+window.scrollY,n=t.height,r=t.width;return o<=i+n&&o>=i&&e<=s+r&&e>=s}focusZoom(e,o=!1){const s=e.target,i=s.getBoundingClientRect();let n=e.pageX,r=e.pageY;if("TouchEvent"===e.constructor.name&&(n=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY),!o&&!t.inBoundaries(i,n,r))return;const a=(n-(i.left+window.scrollX))/i.width*100,l=(r-(i.top+window.scrollY))/i.height*100;s.style.scale=this.config.scale,s.style.transformOrigin=`${a}% ${l}%`,this.zoomedIn=!0}focusZoomOut(t){const e=t.target;e.style.removeProperty("scale"),setTimeout((()=>{e.style.removeProperty("transform-origin")}),this.config.transitionDuration),this.zoomedIn=!1}touchEnd(t){if(!this.zoomedIn)return;const e=(new Date).getTime(),o=e-this.lastTap;clearTimeout(this.timeout),o<500&&o>0?(t.preventDefault(),this.focusZoomOut.call(this,t)):this.timeout=setTimeout((()=>{clearTimeout(this.timeout)}),500),this.lastTap=e}mouseEnter(t){const e=t.target;e.attributes.zoomify&&""!==e.attributes.zoomify.value&&(e.setAttribute("data-src",e.attributes.src.value),e.attributes.src.value=e.attributes.zoomify.value)}mouseOut(t){const e=t.target;setTimeout((()=>{e.attributes.zoomify&&""!==e.attributes.zoomify.value&&(e.attributes.src.value=e.attributes["data-src"].value)}),this.config.transitionDuration)}destroy(){this.zoomOut(),this.setZoomEvents(!0),this.config.clickToZoom&&this.getElement().parentElement.querySelector("#zoomifyJs-click-to-zoom").remove(),delete this.getElement().zoomifyJs}};return e(o,"ALLOWED_OPTIONS",["selector","transitionDuration","easing","scale","clickToZoom","buttonText"]),e(o,"DEFAULT_SETTINGS",{selector:".zoomifyJs",transitionDuration:300,easing:"ease-in-out",scale:2,clickToZoom:!1,buttonText:"Click to zoom"}),o}));
